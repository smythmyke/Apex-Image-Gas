#!/usr/bin/env node

const admin = require('firebase-admin');
const serviceAccount = require('../serviceAccountKey.json');

// Initialize Firebase Admin
if (!admin.apps.length) {
  admin.initializeApp({
    credential: admin.credential.cert(serviceAccount),
    projectId: 'apex-gas-9920e'
  });
}

const db = admin.firestore();

async function checkAutomationLogs() {
  try {
    console.log('ðŸ” Checking Blog Automation Logs...\n');
    
    // Get all automation logs
    const logsSnapshot = await db.collection('blogAutomationLogs')
      .orderBy('timestamp', 'desc')
      .limit(20)
      .get();
    
    if (logsSnapshot.empty) {
      console.log('No automation logs found');
    } else {
      console.log(`Found ${logsSnapshot.size} log entries:\n`);
      
      logsSnapshot.forEach((doc) => {
        const data = doc.data();
        console.log('-----------------------------------');
        console.log('Log ID:', doc.id);
        console.log('Type:', data.type);
        console.log('Success:', data.success);
        console.log('Timestamp:', data.timestamp?.toDate().toLocaleString());
        
        if (data.blogId) {
          console.log('Blog ID:', data.blogId);
          console.log('Blog URL: https://blog.apeximagegas.net/[slug]');
        }
        
        if (data.topic) console.log('Topic:', data.topic);
        if (data.category) console.log('Category:', data.category);
        if (data.error) console.log('Error:', data.error);
        
        console.log('');
      });
    }
    
    // Also check for any published blogs
    console.log('\nðŸ“„ Checking Published Blog Posts...\n');
    
    const blogsSnapshot = await db.collection('blogPosts')
      .where('status', '==', 'published')
      .orderBy('publishedAt', 'desc')
      .limit(10)
      .get();
    
    if (blogsSnapshot.empty) {
      console.log('No published blog posts found');
    } else {
      console.log(`Found ${blogsSnapshot.size} published blog posts:\n`);
      
      blogsSnapshot.forEach((doc) => {
        const data = doc.data();
        console.log('-----------------------------------');
        console.log('Blog ID:', doc.id);
        console.log('Title:', data.title);
        console.log('Slug:', data.slug);
        console.log('Category:', data.category);
        console.log('Published:', data.publishedAt?.toDate().toLocaleString());
        console.log('Blog URL: https://blog.apeximagegas.net/' + data.slug);
        console.log('Generated by:', data.metadata?.generatedBy || 'unknown');
        console.log('');
      });
    }
    
  } catch (error) {
    console.error('Error:', error);
  } finally {
    process.exit(0);
  }
}

checkAutomationLogs();